<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>时间计算器 - 倒计时版</title>
    <style>
        :root {
            --primary-color: #4CAF50;
            --primary-dark: #45a049;
            --primary-light: #e8f5e8;
            --secondary-color: #2196F3;
            --secondary-light: #e8f4fd;
            --danger-color: #f44336;
            --danger-light: #ffebee;
            --warning-color: #ff9800;
            --warning-light: #fff3e0;
            --text-color: #333;
            --light-text: #666;
            --border-color: #ddd;
            --border-radius: 8px;
            --shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: var(--text-color);
            background-color: #f5f5f5;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .container {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        header {
            text-align: center;
            margin-bottom: 20px;
        }

        h1 {
            color: var(--primary-color);
            margin-bottom: 10px;
        }

        .current-time {
            background-color: var(--primary-light);
            border: 2px solid var(--primary-color);
            border-radius: var(--border-radius);
            padding: 15px;
            font-size: 18px;
            font-weight: bold;
            color: #2e7d32;
            text-align: center;
            margin-bottom: 20px;
        }

        .tabs {
            display: flex;
            background-color: white;
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: var(--shadow);
        }

        .tab-button {
            flex: 1;
            padding: 15px;
            background-color: #f1f1f1;
            border: none;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: background-color 0.3s;
            color: #333; /* 黑色字体 */
        }

        .tab-button:hover {
            background-color: #e1e1e1;
        }

        .tab-button.active {
            background-color: white;
            border-bottom: 3px solid var(--primary-color);
        }

        .tab-content {
            display: none;
            background-color: white;
            padding: 20px;
            border-radius: 0 0 var(--border-radius) var(--border-radius);
            box-shadow: var(--shadow);
        }

        .tab-content.active {
            display: block;
        }

        .section {
            margin-bottom: 25px;
        }

        .section-title {
            font-weight: bold;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--border-color);
            color: #333; /* 黑色字体 */
        }

        .input-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            color: #333; /* 黑色字体 */
            font-size: 14px;
        }

        input, select {
            width: 100%;
            padding: 10px;
            border: 2px solid var(--border-color);
            border-radius: 4px;
            font-size: 16px;
        }

        input:focus, select:focus {
            border-color: var(--primary-color);
            outline: none;
        }

        .button-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 15px;
        }

        button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        button:hover {
            background-color: var(--primary-dark);
        }

        button:disabled {
            background-color: #cccccc;
            color: #666666;
            cursor: not-allowed;
        }

        .quick-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }

        .countdown-display {
            background-color: var(--secondary-light);
            border: 2px solid var(--secondary-color);
            border-radius: var(--border-radius);
            padding: 20px;
            font-size: 18px;
            font-weight: bold;
            color: #0d47a1;
            text-align: center;
            margin-bottom: 15px;
            min-height: 120px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .timer-display {
            background-color: var(--primary-light);
            border: 2px solid var(--primary-color);
            border-radius: var(--border-radius);
            padding: 20px;
            font-size: 32px;
            font-weight: bold;
            color: #2e7d32;
            text-align: center;
            margin-bottom: 15px;
            min-height: 100px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .progress-container {
            margin: 15px 0;
        }

        .progress-bar {
            width: 100%;
            height: 25px;
            background-color: #f1f1f1;
            border-radius: 5px;
            overflow: hidden;
            border: 2px solid grey;
        }

        .progress-fill {
            height: 100%;
            background-color: var(--primary-color);
            transition: width 0.1s;
        }

        .progress-text {
            text-align: center;
            margin-top: 5px;
            color: #333; /* 黑色字体 */
            font-size: 14px;
            font-weight: bold;
        }

        .results {
            background-color: #fafafa;
            border: 2px solid var(--border-color);
            border-radius: var(--border-radius);
            padding: 15px;
            min-height: 200px;
            font-family: Consolas, Monaco, monospace;
            white-space: pre-wrap;
            overflow-y: auto;
            max-height: 300px;
        }

        .examples {
            background-color: white;
            border-radius: var(--border-radius);
            padding: 15px;
            box-shadow: var(--shadow);
            color: #333; /* 黑色字体 */
            font-size: 14px;
        }

        .examples h3 {
            margin-bottom: 10px;
            color: #333; /* 黑色字体 */
        }

        .error-message {
            color: var(--danger-color);
            background-color: var(--danger-light);
            padding: 10px;
            border-radius: 4px;
            margin-top: 10px;
            display: none;
        }

        .success-message {
            color: var(--primary-color);
            background-color: var(--primary-light);
            padding: 10px;
            border-radius: 4px;
            margin-top: 10px;
            display: none;
        }

        .keyboard-hint {
            color: #666;
            font-size: 12px;
            margin-top: 5px;
        }

        @media (max-width: 768px) {
            .tabs {
                flex-direction: column;
            }

            .quick-buttons {
                grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            }

            .button-group {
                flex-direction: column;
            }

            button {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>时间计算器</h1>
            <div class="current-time" id="currentTime">当前时间：2025-10-14 08:23:50</div>
        </header>

        <div class="tabs">
            <button class="tab-button active" data-tab="basic">基础计算</button>
            <button class="tab-button" data-tab="quick">快速计算</button>
            <button class="tab-button" data-tab="countdown">倒计时</button>
            <button class="tab-button" data-tab="timer">计时器</button>
        </div>

        <div class="tab-content active" id="basic-tab">
            <div class="section">
                <div class="section-title">基础时间设置</div>
                <div class="input-group">
                    <label for="baseTime">基础时间 (留空或输入 'now' 使用当前时间)</label>
                    <input type="text" id="baseTime" placeholder="例如: 2024-01-01 10:00:00, 2024/01/01 10:00, now, 或留空">
                    <div class="keyboard-hint">按回车键快速计算</div>
                </div>
            </div>

            <div class="section">
                <div class="section-title">增加时间设置</div>
                <div class="input-group">
                    <label for="duration">持续时间 (支持格式: 2h30m, 1天2小时, 90(分钟), 1d3h15m等)</label>
                    <input type="text" id="duration" placeholder="例如: 2h30m, 1天2小时, 90, 1d3h15m">
                    <div class="keyboard-hint">按回车键快速计算</div>
                </div>
            </div>

            <button id="calculateBtn">计算</button>
        </div>

        <div class="tab-content" id="quick-tab">
            <div class="section">
                <div class="section-title">快速增加时间</div>
                <p>从当前时间快速增加指定时长</p>

                <div class="quick-buttons">
                    <button class="quick-btn" data-duration="30m">30分钟</button>
                    <button class="quick-btn" data-duration="1h">1小时</button>
                    <button class="quick-btn" data-duration="2h">2小时</button>
                    <button class="quick-btn" data-duration="1d">1天</button>
                    <button class="quick-btn" data-duration="7d">1周</button>
                    <button class="quick-btn" data-duration="30d">1个月</button>
                </div>

                <div class="input-group" style="margin-top: 20px;">
                    <label for="quickDuration">自定义时长</label>
                    <input type="text" id="quickDuration" placeholder="输入自定义时长，如: 2h30m">
                    <div class="keyboard-hint">按回车键快速计算</div>
                </div>

                <button id="quickCalculateBtn">快速计算</button>
            </div>
        </div>

        <div class="tab-content" id="countdown-tab">
            <div class="countdown-display" id="countdownDisplay">
                未设置倒计时
            </div>

            <div class="progress-container">
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill" style="width: 0%;"></div>
                </div>
                <div class="progress-text" id="progressText">进度: 0.00%</div>
            </div>

            <div class="section">
                <div class="section-title">倒计时设置</div>

                <div class="input-group">
                    <label for="targetTime">目标时间</label>
                    <input type="text" id="targetTime" placeholder="例如: 2024-01-01 10:00:00, 10:30, 或 2024年1月1日 10时">
                    <div class="keyboard-hint">按回车键设置目标时间</div>
                </div>

                <div class="button-group">
                    <button id="setTargetBtn">设置目标时间</button>
                    <button id="startTargetBtn" disabled>开始目标倒计时</button>
                </div>

                <div class="quick-buttons" style="margin-top: 15px;">
                    <button class="common-target" data-target="5m">+5分钟</button>
                    <button class="common-target" data-target="15m">+15分钟</button>
                    <button class="common-target" data-target="30m">+30分钟</button>
                    <button class="common-target" data-target="1h">+1小时</button>
                    <button class="common-target" data-target="2h">+2小时</button>
                    <button class="common-target" data-target="1d">明天此时</button>
                </div>
            </div>

            <div class="section">
                <div class="input-group">
                    <label for="countdownDuration">时长</label>
                    <input type="text" id="countdownDuration" placeholder="例如: 2h30m, 1天2小时, 90分钟">
                    <div class="keyboard-hint">按回车键设置时长</div>
                </div>

                <div class="button-group">
                    <button id="setDurationBtn">设置时长</button>
                    <button id="startDurationBtn" disabled>开始时长倒计时</button>
                </div>

                <div class="quick-buttons" style="margin-top: 15px;">
                    <button class="fixed-duration" data-duration="5m">5分钟</button>
                    <button class="fixed-duration" data-duration="10m">10分钟</button>
                    <button class="fixed-duration" data-duration="15m">15分钟</button>
                    <button class="fixed-duration" data-duration="20m">20分钟</button>
                    <button class="fixed-duration" data-duration="25m">25分钟</button>
                    <button class="fixed-duration" data-duration="30m">30分钟</button>
                    <button class="fixed-duration" data-duration="45m">45分钟</button>
                    <button class="fixed-duration" data-duration="1h">1小时</button>
                </div>
            </div>

            <div class="section">
                <div class="section-title">倒计时控制</div>
                <div class="button-group">
                    <button id="pauseCountdownBtn" disabled>暂停 (空格键)</button>
                    <button id="resumeCountdownBtn" disabled>继续 (空格键)</button>
                    <button id="stopCountdownBtn" disabled>停止 (Esc键)</button>
                    <button id="resetCountdownBtn">重置 (R键)</button>
                </div>
            </div>

            <div class="error-message" id="countdownError"></div>
            <div class="success-message" id="countdownSuccess"></div>
        </div>

        <div class="tab-content" id="timer-tab">
            <div class="timer-display" id="timerDisplay">00:00:00</div>

            <div class="section">
                <div class="section-title">计时器控制</div>
                <div class="button-group">
                    <button id="startTimerBtn">开始 (空格键)</button>
                    <button id="pauseTimerBtn" disabled>暂停 (空格键)</button>
                    <button id="resumeTimerBtn" disabled>继续 (空格键)</button>
                    <button id="stopTimerBtn" disabled>停止 (Esc键)</button>
                    <button id="resetTimerBtn">重置 (R键)</button>
                </div>
            </div>

            <div class="section">
                <div class="section-title">计时器信息</div>
                <p id="timerInfo">计时器未启动</p>
            </div>
        </div>

        <div class="section">
            <div class="section-title">计算结果</div>
            <div class="results" id="resultsDisplay"></div>
        </div>

        <div class="examples">
            <h3>使用示例</h3>
            <p><strong>基础时间示例:</strong></p>
            <ul>
                <li>2024-01-01 10:00:00</li>
                <li>2024/01/01 10:00</li>
                <li>2024年1月1日 10时30分</li>
                <li>10:30:00</li>
                <li>now (或留空使用当前时间)</li>
            </ul>

            <p><strong>增加时间示例:</strong></p>
            <ul>
                <li>2h30m (2小时30分钟)</li>
                <li>1d3h15m (1天3小时15分钟)</li>
                <li>1天2小时30分钟 (中文)</li>
                <li>90 (纯数字，默认为分钟)</li>
                <li>1.5h (1.5小时)</li>
            </ul>

            <p><strong>目标时间倒计时:</strong></p>
            <ul>
                <li>自定义目标时间: 2024-01-01 10:00:00</li>
                <li>常用目标: +5分钟, +15分钟, +30分钟, +1小时, +2小时, 明天此时</li>
                <li>自动计算剩余时间并开始倒计时</li>
            </ul>

            <p><strong>时长倒计时:</strong></p>
            <ul>
                <li>倒计时时长: 2h30m</li>
                <li>固定时间: 点击按钮快速设置</li>
                <li>支持暂停/继续/停止/重置</li>
                <li>进度条显示精确到小数后两位</li>
            </ul>

            <p><strong>计时器功能:</strong></p>
            <ul>
                <li>从0开始递增计时</li>
                <li>支持暂停/继续/停止/重置</li>
            </ul>

            <p><strong>键盘快捷键:</strong></p>
            <ul>
                <li>回车键: 在输入框中进行快速计算/设置</li>
                <li>空格键: 暂停/继续倒计时或计时器</li>
                <li>Esc键: 停止倒计时或计时器</li>
                <li>R键: 重置倒计时或计时器</li>
            </ul>
        </div>
    </div>

    <script>
        // 全局变量
        let currentTab = 'basic';
        let countdownInterval = null;
        let timerInterval = null;
        let countdownData = {
            initialDuration: 0,
            remainingTime: 0,
            isRunning: false,
            isPaused: false,
            startTime: null,
            pauseTime: null,
            targetTime: null,
            mode: 'duration'
        };

        let timerData = {
            startTime: null,
            elapsedTime: 0,
            isRunning: false,
            isPaused: false
        };

        // 初始化
        document.addEventListener('DOMContentLoaded', function() {
            // 更新当前时间
            updateCurrentTime();
            setInterval(updateCurrentTime, 1000);

            // 选项卡切换
            document.querySelectorAll('.tab-button').forEach(button => {
                button.addEventListener('click', function() {
                    // 移除所有活动状态
                    document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));

                    // 设置当前选项卡为活动状态
                    this.classList.add('active');
                    currentTab = this.getAttribute('data-tab');
                    document.getElementById(`${currentTab}-tab`).classList.add('active');
                });
            });

            // 基础计算
            document.getElementById('calculateBtn').addEventListener('click', calculateTime);
            document.getElementById('baseTime').addEventListener('keydown', function(e) {
                if (e.key === 'Enter') {
                    calculateTime();
                }
            });
            document.getElementById('duration').addEventListener('keydown', function(e) {
                if (e.key === 'Enter') {
                    calculateTime();
                }
            });

            // 快速计算
            document.querySelectorAll('.quick-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const duration = this.getAttribute('data-duration');
                    performQuickCalculation(duration);
                });
            });
            document.getElementById('quickCalculateBtn').addEventListener('click', function() {
                const duration = document.getElementById('quickDuration').value;
                if (!duration) {
                    alert('请输入要增加的时间');
                    return;
                }
                performQuickCalculation(duration);
            });
            document.getElementById('quickDuration').addEventListener('keydown', function(e) {
                if (e.key === 'Enter') {
                    const duration = document.getElementById('quickDuration').value;
                    if (!duration) {
                        alert('请输入要增加的时间');
                        return;
                    }
                    performQuickCalculation(duration);
                }
            });

            // 倒计时功能
            document.getElementById('setTargetBtn').addEventListener('click', setTargetTimeCountdown);
            document.getElementById('startTargetBtn').addEventListener('click', startTargetCountdown);
            document.getElementById('setDurationBtn').addEventListener('click', setDurationCountdown);
            document.getElementById('startDurationBtn').addEventListener('click', startDurationCountdown);

            document.getElementById('targetTime').addEventListener('keydown', function(e) {
                if (e.key === 'Enter') {
                    setTargetTimeCountdown();
                }
            });

            document.getElementById('countdownDuration').addEventListener('keydown', function(e) {
                if (e.key === 'Enter') {
                    setDurationCountdown();
                }
            });

            document.querySelectorAll('.common-target').forEach(btn => {
                btn.addEventListener('click', function() {
                    const targetType = this.getAttribute('data-target');
                    setCommonTargetTime(targetType);
                });
            });

            document.querySelectorAll('.fixed-duration').forEach(btn => {
                btn.addEventListener('click', function() {
                    const duration = this.getAttribute('data-duration');
                    document.getElementById('countdownDuration').value = duration;
                    setDurationCountdown();
                    startDurationCountdown();
                });
            });

            document.getElementById('pauseCountdownBtn').addEventListener('click', pauseCountdown);
            document.getElementById('resumeCountdownBtn').addEventListener('click', resumeCountdown);
            document.getElementById('stopCountdownBtn').addEventListener('click', stopCountdown);
            document.getElementById('resetCountdownBtn').addEventListener('click', resetCountdown);

            // 计时器功能
            document.getElementById('startTimerBtn').addEventListener('click', startTimer);
            document.getElementById('pauseTimerBtn').addEventListener('click', pauseTimer);
            document.getElementById('resumeTimerBtn').addEventListener('click', resumeTimer);
            document.getElementById('stopTimerBtn').addEventListener('click', stopTimer);
            document.getElementById('resetTimerBtn').addEventListener('click', resetTimer);

            // 键盘快捷键
            document.addEventListener('keydown', function(e) {
                // 空格键控制倒计时/计时器的暂停/继续
                if (e.key === ' ') {
                    e.preventDefault();

                    if (currentTab === 'countdown') {
                        if (countdownData.isRunning && !countdownData.isPaused) {
                            pauseCountdown();
                        } else if (countdownData.isPaused) {
                            resumeCountdown();
                        }
                    } else if (currentTab === 'timer') {
                        if (timerData.isRunning && !timerData.isPaused) {
                            pauseTimer();
                        } else if (timerData.isPaused) {
                            resumeTimer();
                        } else if (!timerData.isRunning) {
                            startTimer();
                        }
                    }
                }

                // Esc键停止倒计时/计时器
                if (e.key === 'Escape') {
                    if (currentTab === 'countdown') {
                        stopCountdown();
                    } else if (currentTab === 'timer') {
                        stopTimer();
                    }
                }

                // R键重置倒计时/计时器
                if (e.key === 'r' || e.key === 'R') {
                    if (currentTab === 'countdown') {
                        resetCountdown();
                    } else if (currentTab === 'timer') {
                        resetTimer();
                    }
                }
            });

            // 启动倒计时更新
            setInterval(updateCountdown, 100);
        });

        // 更新当前时间显示
        function updateCurrentTime() {
            const now = new Date();
            const formattedTime = formatDateTime(now);
            document.getElementById('currentTime').textContent = `当前时间：${formattedTime}`;
        }

        // 格式化日期时间
        function formatDateTime(date) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            const hours = String(date.getHours()).padStart(2, '0');
            const minutes = String(date.getMinutes()).padStart(2, '0');
            const seconds = String(date.getSeconds()).padStart(2, '0');

            return `${year}-${month}-${day} ${hours}:${minutes}:${seconds}`;
        }

        // 基础计算功能
        function calculateTime() {
            const baseTime = document.getElementById('baseTime').value.trim();
            const duration = document.getElementById('duration').value.trim();

            if (!duration) {
                alert('请输入要增加的时间');
                return;
            }

            try {
                const result = increaseTime(baseTime, duration);
                displayResults(baseTime, duration, result);
            } catch (error) {
                alert(`计算错误: ${error.message}`);
            }
        }

        // 快速计算功能
        function performQuickCalculation(duration) {
            try {
                const result = increaseTime('', duration);
                displayQuickResults(duration, result);
            } catch (error) {
                alert(`计算错误: ${error.message}`);
            }
        }

        // 增加时间计算
        function increaseTime(baseTime, duration) {
            const now = new Date();
            let baseDate;

            if (!baseTime || baseTime.toLowerCase() === 'now') {
                baseDate = new Date(now);
            } else {
                baseDate = parseTime(baseTime);
                if (isNaN(baseDate.getTime())) {
                    throw new Error('无法解析基础时间');
                }
            }

            const durationMs = parseDuration(duration);
            if (isNaN(durationMs)) {
                throw new Error('无法解析持续时间');
            }

            return new Date(baseDate.getTime() + durationMs);
        }

        // 解析时间字符串
        function parseTime(timeStr) {
            // 简化版本 - 实际应用中需要更复杂的解析逻辑
            // 这里仅处理一些常见格式

            // 移除中文和特殊字符
            const cleaned = timeStr.replace(/[年月日时分秒]/g, ' ').replace(/\s+/g, ' ').trim();

            // 尝试解析为日期时间
            const date = new Date(cleaned);
            if (!isNaN(date.getTime())) {
                return date;
            }

            // 尝试解析为时间（假设为今天）
            const timeMatch = cleaned.match(/(\d{1,2}):(\d{1,2})(?::(\d{1,2}))?/);
            if (timeMatch) {
                const now = new Date();
                const hours = parseInt(timeMatch[1]);
                const minutes = parseInt(timeMatch[2]);
                const seconds = timeMatch[3] ? parseInt(timeMatch[3]) : 0;

                return new Date(now.getFullYear(), now.getMonth(), now.getDate(), hours, minutes, seconds);
            }

            throw new Error(`无法解析时间字符串: ${timeStr}`);
        }

        // 解析持续时间
        function parseDuration(durationStr) {
            if (!durationStr.trim()) {
                throw new Error('持续时间不能为空');
            }

            const str = durationStr.toLowerCase().trim();

            // 尝试解析纯数字（默认为分钟）
            if (/^\d+$/.test(str)) {
                return parseInt(str) * 60 * 1000;
            }

            // 匹配数字和单位
            const pattern = /(\d+(?:\.\d+)?)\s*([a-z\u4e00-\u9fff]+)/g;
            let match;
            let totalMs = 0;

            while ((match = pattern.exec(str)) !== null) {
                const value = parseFloat(match[1]);
                const unit = match[2];

                switch (unit) {
                    case 'd': case 'day': case 'days': case '天':
                        totalMs += value * 24 * 60 * 60 * 1000;
                        break;
                    case 'h': case 'hour': case 'hours': case '小时': case '时':
                        totalMs += value * 60 * 60 * 1000;
                        break;
                    case 'm': case 'min': case 'minute': case 'minutes': case '分钟': case '分':
                        totalMs += value * 60 * 1000;
                        break;
                    case 's': case 'sec': case 'second': case 'seconds': case '秒':
                        totalMs += value * 1000;
                        break;
                    default:
                        throw new Error(`未知的时间单位: ${unit}`);
                }
            }

            if (totalMs === 0) {
                throw new Error(`无法解析持续时间: ${durationStr}`);
            }

            return totalMs;
        }

        // 显示详细计算结果
        function displayResults(baseTime, duration, result) {
            const baseDisplay = !baseTime || baseTime.toLowerCase() === 'now' ? '当前时间' : baseTime;
            const resultFormatted = formatDateTime(result);

            let output = `=== 时间计算器结果 ===

基础时间: ${baseDisplay}
增加时长: ${duration}
结果时间: ${resultFormatted}

多种格式输出:
  • 标准格式: ${resultFormatted}
  • 中文格式: ${formatDateTimeChinese(result)}
  • 紧凑格式: ${formatDateTimeCompact(result)}
  • 仅日期: ${formatDate(result)}
  • 仅时间: ${formatTime(result)}

时间差信息:`;

            const now = new Date();
            const timeDiff = result.getTime() - now.getTime();

            if (timeDiff > 0) {
                const totalSeconds = timeDiff / 1000;
                const days = Math.floor(totalSeconds / 86400);
                const hours = Math.floor((totalSeconds % 86400) / 3600);
                const minutes = Math.floor((totalSeconds % 3600) / 60);
                const seconds = Math.floor(totalSeconds % 60);

                output += `
  • 总共相差: ${days}天 ${hours}小时 ${minutes}分钟 ${seconds}秒
  • 总小时数: ${(totalSeconds / 3600).toFixed(2)} 小时
  • 总分钟数: ${(totalSeconds / 60).toFixed(2)} 分钟
  • 总秒数: ${totalSeconds.toFixed(0)} 秒`;
            }

            output += `\n\n计算时间: ${formatDateTime(now)}`;
            output += `\n${'='.repeat(50)}`;

            document.getElementById('resultsDisplay').textContent = output;
        }

        // 显示快速计算结果
        function displayQuickResults(duration, result) {
            const output = `[快速计算] 当前时间 + ${duration} = ${formatDateTime(result)}\n`;
            const resultsDisplay = document.getElementById('resultsDisplay');

            // 保留最近的几条记录
            const currentText = resultsDisplay.textContent;
            if (currentText.length > 2000) {
                resultsDisplay.textContent = output;
            } else {
                resultsDisplay.textContent = output + currentText;
            }
        }

        // 格式化日期时间（中文）
        function formatDateTimeChinese(date) {
            const year = date.getFullYear();
            const month = date.getMonth() + 1;
            const day = date.getDate();
            const hours = String(date.getHours()).padStart(2, '0');
            const minutes = String(date.getMinutes()).padStart(2, '0');
            const seconds = String(date.getSeconds()).padStart(2, '0');

            return `${year}年${month}月${day}日 ${hours}时${minutes}分${seconds}秒`;
        }

        // 格式化日期时间（紧凑）
        function formatDateTimeCompact(date) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            const hours = String(date.getHours()).padStart(2, '0');
            const minutes = String(date.getMinutes()).padStart(2, '0');
            const seconds = String(date.getSeconds()).padStart(2, '0');

            return `${year}${month}${day}_${hours}${minutes}${seconds}`;
        }

        // 格式化日期
        function formatDate(date) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');

            return `${year}-${month}-${day}`;
        }

        // 格式化时间
        function formatTime(date) {
            const hours = String(date.getHours()).padStart(2, '0');
            const minutes = String(date.getMinutes()).padStart(2, '0');
            const seconds = String(date.getSeconds()).padStart(2, '0');

            return `${hours}:${minutes}:${seconds}`;
        }

        // 倒计时功能
        function setTargetTimeCountdown() {
            const targetTimeStr = document.getElementById('targetTime').value.trim();
            if (!targetTimeStr) {
                showCountdownError('请输入目标时间');
                return;
            }

            try {
                const targetTime = parseTime(targetTimeStr);
                const now = new Date();

                if (targetTime <= now) {
                    showCountdownError('目标时间必须晚于当前时间');
                    return;
                }

                countdownData.targetTime = targetTime;
                countdownData.initialDuration = targetTime.getTime() - now.getTime();
                countdownData.remainingTime = countdownData.initialDuration;
                countdownData.isRunning = false;
                countdownData.isPaused = false;
                countdownData.mode = 'target';

                // 清空时长输入框
                document.getElementById('countdownDuration').value = '';

                updateCountdownButtons();
                updateCountdownDisplay();
                showCountdownSuccess(`目标时间已设置为: ${formatDateTime(targetTime)}`);
            } catch (error) {
                showCountdownError(`无法设置目标时间: ${error.message}`);
            }
        }

        function setCommonTargetTime(targetType) {
            const now = new Date();
            let targetTime;

            switch (targetType) {
                case '5m':
                    targetTime = new Date(now.getTime() + 5 * 60 * 1000);
                    break;
                case '15m':
                    targetTime = new Date(now.getTime() + 15 * 60 * 1000);
                    break;
                case '30m':
                    targetTime = new Date(now.getTime() + 30 * 60 * 1000);
                    break;
                case '1h':
                    targetTime = new Date(now.getTime() + 60 * 60 * 1000);
                    break;
                case '2h':
                    targetTime = new Date(now.getTime() + 2 * 60 * 60 * 1000);
                    break;
                case '1d':
                    targetTime = new Date(now.getTime() + 24 * 60 * 60 * 1000);
                    break;
                default:
                    showCountdownError('未知的目标时间类型');
                    return;
            }

            document.getElementById('targetTime').value = formatDateTime(targetTime);
            setTargetTimeCountdown();
            startTargetCountdown();
        }

        function startTargetCountdown() {
            if (countdownData.mode === 'target' && countdownData.initialDuration > 0) {
                countdownData.startTime = new Date();
                countdownData.isRunning = true;
                countdownData.isPaused = false;

                updateCountdownButtons();
                showCountdownSuccess('目标时间倒计时已开始！');
            }
        }

        function setDurationCountdown() {
            const durationStr = document.getElementById('countdownDuration').value.trim();
            if (!durationStr) {
                showCountdownError('请输入倒计时时长');
                return;
            }

            try {
                const durationMs = parseDuration(durationStr);
                const now = new Date();

                countdownData.initialDuration = durationMs;
                countdownData.remainingTime = durationMs;
                countdownData.targetTime = new Date(now.getTime() + durationMs);
                countdownData.isRunning = false;
                countdownData.isPaused = false;
                countdownData.mode = 'duration';

                // 清空目标时间输入框
                document.getElementById('targetTime').value = '';

                updateCountdownButtons();
                updateCountdownDisplay();
                showCountdownSuccess(`倒计时已设置为: ${durationStr}`);
            } catch (error) {
                showCountdownError(`无法解析时长: ${error.message}`);
            }
        }

        function startDurationCountdown() {
            if (countdownData.mode === 'duration' && countdownData.initialDuration > 0) {
                countdownData.startTime = new Date();
                countdownData.isRunning = true;
                countdownData.isPaused = false;

                updateCountdownButtons();
                showCountdownSuccess('时长倒计时已开始！');
            }
        }

        function pauseCountdown() {
            if (countdownData.isRunning && !countdownData.isPaused) {
                countdownData.pauseTime = new Date();
                const elapsed = countdownData.pauseTime.getTime() - countdownData.startTime.getTime();
                countdownData.remainingTime -= elapsed;
                countdownData.isPaused = true;

                updateCountdownButtons();
            }
        }

        function resumeCountdown() {
            if (countdownData.isRunning && countdownData.isPaused) {
                countdownData.startTime = new Date(countdownData.startTime.getTime() +
                    (new Date().getTime() - countdownData.pauseTime.getTime()));
                countdownData.isPaused = false;

                updateCountdownButtons();
            }
        }

        function stopCountdown() {
            countdownData.isRunning = false;
            countdownData.isPaused = false;
            updateCountdownButtons();
        }

        function resetCountdown() {
            countdownData.initialDuration = 0;
            countdownData.remainingTime = 0;
            countdownData.isRunning = false;
            countdownData.isPaused = false;
            countdownData.startTime = null;
            countdownData.pauseTime = null;
            countdownData.targetTime = null;

            // 清空输入框
            document.getElementById('targetTime').value = '';
            document.getElementById('countdownDuration').value = '';

            updateCountdownButtons();
            updateCountdownDisplay();
            hideCountdownMessages();
        }

        function updateCountdown() {
            if (countdownData.isRunning && !countdownData.isPaused) {
                const currentTime = new Date();

                if (countdownData.mode === 'duration') {
                    const elapsed = currentTime.getTime() - countdownData.startTime.getTime();
                    const newRemaining = countdownData.initialDuration - elapsed;

                    if (newRemaining <= 0) {
                        countdownData.remainingTime = 0;
                        countdownData.isRunning = false;
                    } else {
                        countdownData.remainingTime = newRemaining;
                    }
                } else { // target mode
                    const newRemaining = countdownData.targetTime.getTime() - currentTime.getTime();

                    if (newRemaining <= 0) {
                        countdownData.remainingTime = 0;
                        countdownData.isRunning = false;
                    } else {
                        countdownData.remainingTime = newRemaining;
                    }
                }

                updateCountdownDisplay();
            }
        }

        function updateCountdownDisplay() {
            const display = document.getElementById('countdownDisplay');
            const progressFill = document.getElementById('progressFill');
            const progressText = document.getElementById('progressText');

            if (countdownData.initialDuration === 0) {
                display.textContent = '未设置倒计时';
                progressFill.style.width = '0%';
                progressText.textContent = '进度: 0.00%';
                return;
            }

            if (countdownData.remainingTime <= 0 && countdownData.initialDuration > 0) {
                display.textContent = '倒计时结束！';
                progressFill.style.width = '0%';
                progressText.textContent = '进度: 0.00%';

                // 闪烁效果
                if (display.style.backgroundColor !== 'rgb(255, 235, 238)') {
                    display.style.backgroundColor = '#ffebee';
                    display.style.borderColor = '#f44336';
                    display.style.color = '#c62828';
                } else {
                    display.style.backgroundColor = '#e8f4fd';
                    display.style.borderColor = '#2196F3';
                    display.style.color = '#0d47a1';
                }

                return;
            }

            const remainingFormatted = formatTimeDelta(countdownData.remainingTime);
            const targetTimeStr = countdownData.targetTime ? formatDateTime(countdownData.targetTime) : '未设置';
            const initialStr = formatTimeDelta(countdownData.initialDuration);
            const modeDesc = countdownData.mode === 'duration' ? '时长模式' : '目标时间模式';

            let displayText;
            if (countdownData.mode === 'target') {
                displayText = `目标时间: ${targetTimeStr}\n剩余时间: ${remainingFormatted}\n模式: ${modeDesc}`;
            } else {
                displayText = `设定时长: ${initialStr}\n剩余时间: ${remainingFormatted}\n目标时间: ${targetTimeStr}\n模式: ${modeDesc}`;
            }

            display.textContent = displayText;

            // 更新进度条和百分比标签
            const progress = (countdownData.remainingTime / countdownData.initialDuration) * 100;
            progressFill.style.width = `${progress}%`;
            progressText.textContent = `进度: ${progress.toFixed(2)}%`;

            // 根据剩余时间百分比改变颜色
            if (progress < 10) {
                display.style.backgroundColor = '#ffebee';
                display.style.borderColor = '#f44336';
                display.style.color = '#c62828';
            } else if (progress < 30) {
                display.style.backgroundColor = '#fff3e0';
                display.style.borderColor = '#ff9800';
                display.style.color = '#ef6c00';
            } else {
                display.style.backgroundColor = '#e8f4fd';
                display.style.borderColor = '#2196F3';
                display.style.color = '#0d47a1';
            }
        }

        function updateCountdownButtons() {
            const hasDuration = countdownData.initialDuration > 0;
            const isRunning = countdownData.isRunning;
            const isPaused = countdownData.isPaused;
            const isFinished = countdownData.remainingTime <= 0 && countdownData.initialDuration > 0;

            // 目标时间相关按钮
            document.getElementById('setTargetBtn').disabled = isRunning;
            document.getElementById('startTargetBtn').disabled =
                !hasDuration || isRunning || isFinished || countdownData.mode !== 'target';

            // 时长相关按钮
            document.getElementById('setDurationBtn').disabled = isRunning;
            document.getElementById('startDurationBtn').disabled =
                !hasDuration || isRunning || isFinished || countdownData.mode !== 'duration';

            // 通用控制按钮
            document.getElementById('pauseCountdownBtn').disabled =
                !isRunning || isPaused || isFinished;
            document.getElementById('resumeCountdownBtn').disabled =
                !isPaused || isFinished;
            document.getElementById('stopCountdownBtn').disabled =
                !isRunning || isFinished;
            document.getElementById('resetCountdownBtn').disabled = !hasDuration;
        }

        function formatTimeDelta(milliseconds) {
            if (milliseconds <= 0) {
                return '0秒';
            }

            const totalSeconds = Math.floor(milliseconds / 1000);
            const days = Math.floor(totalSeconds / 86400);
            const hours = Math.floor((totalSeconds % 86400) / 3600);
            const minutes = Math.floor((totalSeconds % 3600) / 60);
            const seconds = totalSeconds % 60;

            const parts = [];
            if (days > 0) parts.push(`${days}天`);
            if (hours > 0) parts.push(`${hours}小时`);
            if (minutes > 0) parts.push(`${minutes}分钟`);
            parts.push(`${seconds}秒`);

            return parts.join(' ');
        }

        function showCountdownError(message) {
            const errorElement = document.getElementById('countdownError');
            errorElement.textContent = message;
            errorElement.style.display = 'block';

            // 隐藏成功消息
            document.getElementById('countdownSuccess').style.display = 'none';

            // 3秒后自动隐藏
            setTimeout(() => {
                errorElement.style.display = 'none';
            }, 3000);
        }

        function showCountdownSuccess(message) {
            const successElement = document.getElementById('countdownSuccess');
            successElement.textContent = message;
            successElement.style.display = 'block';

            // 隐藏错误消息
            document.getElementById('countdownError').style.display = 'none';

            // 3秒后自动隐藏
            setTimeout(() => {
                successElement.style.display = 'none';
            }, 3000);
        }

        function hideCountdownMessages() {
            document.getElementById('countdownError').style.display = 'none';
            document.getElementById('countdownSuccess').style.display = 'none';
        }

        // 计时器功能
        function startTimer() {
            if (!timerData.isRunning) {
                timerData.startTime = new Date();
                timerData.isRunning = true;
                timerData.isPaused = false;

                updateTimerButtons();
                document.getElementById('timerInfo').textContent = '计时器运行中...';
            }
        }

        function pauseTimer() {
            if (timerData.isRunning && !timerData.isPaused) {
                timerData.elapsedTime += new Date().getTime() - timerData.startTime.getTime();
                timerData.isPaused = true;

                updateTimerButtons();
                document.getElementById('timerInfo').textContent = '计时器已暂停';
            }
        }

        function resumeTimer() {
            if (timerData.isRunning && timerData.isPaused) {
                timerData.startTime = new Date();
                timerData.isPaused = false;

                updateTimerButtons();
                document.getElementById('timerInfo').textContent = '计时器运行中...';
            }
        }

        function stopTimer() {
            if (timerData.isRunning) {
                if (!timerData.isPaused) {
                    timerData.elapsedTime += new Date().getTime() - timerData.startTime.getTime();
                }
                timerData.isRunning = false;

                updateTimerButtons();
                const elapsed = formatTimeDelta(timerData.elapsedTime);
                document.getElementById('timerInfo').textContent = `计时器已停止 - 总计: ${elapsed}`;
            }
        }

        function resetTimer() {
            timerData.startTime = null;
            timerData.elapsedTime = 0;
            timerData.isRunning = false;
            timerData.isPaused = false;

            updateTimerButtons();
            document.getElementById('timerDisplay').textContent = '00:00:00';
            document.getElementById('timerInfo').textContent = '计时器已重置';
        }

        function updateTimerButtons() {
            document.getElementById('startTimerBtn').disabled =
                timerData.isRunning && !timerData.isPaused;
            document.getElementById('pauseTimerBtn').disabled =
                !timerData.isRunning || timerData.isPaused;
            document.getElementById('resumeTimerBtn').disabled =
                !timerData.isPaused;
            document.getElementById('stopTimerBtn').disabled =
                !timerData.isRunning;
            document.getElementById('resetTimerBtn').disabled =
                timerData.isRunning;
        }

        function updateTimerDisplay() {
            if (timerData.isRunning && !timerData.isPaused) {
                const currentElapsed = timerData.elapsedTime +
                    (new Date().getTime() - timerData.startTime.getTime());
                document.getElementById('timerDisplay').textContent =
                    formatTimeDeltaAsClock(currentElapsed);
            }
        }

        function formatTimeDeltaAsClock(milliseconds) {
            const totalSeconds = Math.floor(milliseconds / 1000);
            const hours = Math.floor(totalSeconds / 3600);
            const minutes = Math.floor((totalSeconds % 3600) / 60);
            const seconds = totalSeconds % 60;

            return `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
        }

        // 启动计时器更新
        setInterval(updateTimerDisplay, 100);
    </script>
</body>
</html>
